# `git review <branch>` 
# Starts the review process for a branch. WARNING: This drops, created, migrates and seeds your database.
#
#!/usr/bin/env bash
branch="$1"
exist_branch=$(git show-ref "$branch")

if [ -n "$exist_branch" ]; then
  echo "— Review $branch"

  if [ -f "./tmp/pids/server.pid" ]; then
    echo "— Stopping running rails server..."
    kill `cat ./tmp/pids/server.pid`
  fi
  
  echo "— Checking out branch"

  git fetch
  git checkout $branch
  git pull
  
  echo "— Setting up app"

  bundle
  bundle exec rake db:drop db:create db:migrate db:seed

  echo "— Starting rails server"
  rails s -d
else
  echo "No such branch. Listing branches: \n"
  git branch -a
  exit 1
fi
